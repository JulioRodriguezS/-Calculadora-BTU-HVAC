(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const s of e.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&c(s)}).observe(document,{childList:!0,subtree:!0});function d(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function c(o){if(o.ep)return;o.ep=!0;const e=d(o);fetch(o.href,e)}})();const N=30,S=28800,w=650,O=450,_=200,A=[12,18,24,36,46],R=Math.min(...A),M=new Intl.NumberFormat("es-MX"),n=a=>document.getElementById(a),x=a=>{const t=parseFloat(String(a).replace(",","."));return Number.isFinite(t)?t:0},g=a=>a/12e3;let b=0,$=[];async function q(){try{const a=await fetch("/logo.png");if(!a.ok)return null;const t=await a.blob();return await new Promise((d,c)=>{const o=new FileReader;o.onload=()=>d(o.result),o.onerror=c,o.readAsDataURL(t)})}catch{return null}}function D(a,t,d=4,c=!0,o=5){const e=[];let s=1/0;t.sort((r,i)=>i-r);const l=(r,i)=>r.diff-i.diff||r.equipos-i.equipos||(c?(r.suma>=a?0:1)-(i.suma>=a?0:1):0)||i.suma-r.suma;function m(r){const i=r.reduce((u,f)=>u+f,0),v=Math.abs(a-i),h={listaBTU:[...r],suma:i,diff:v,equipos:r.length};e.some(u=>u.suma===i&&u.equipos===h.equipos)||(e.push(h),e.sort(l),e.length>o&&(e.length=o),s=e[0]?.diff??s)}function p(r,i,v){if(i.length>0&&m(i),i.length!==d)for(let h=r;h<t.length;h++){const u=t[h],f=v+u;!c&&f>a||e.length&&Math.abs(a-f)>s+u||(i.push(u),p(h,i,f),i.pop())}}return p(0,[],0),e}function T(){const a=Math.max(0,x(n("area").value)),t=Math.max(0,Math.floor(x(n("personas").value))),d=Math.max(0,x(n("areaVentanas").value)),c=Math.max(0,Math.floor(x(n("luminarias").value))),o=S*a/N,e=w*t,s=O*d,l=_*c,m=o+e+s+l;n("s5").textContent=M.format(Math.round(m))+" BTU",n("tons").textContent=g(m).toFixed(2)+" ton",b=m,j(m)}function j(a){const t=A.map(l=>Math.round(l*1e3)),d=n("toggleOvershoot").checked,c=Math.min(8,Math.max(3,Math.ceil(a/(R*1e3))+2)),o=D(a,t,c,d,5);$=o;const e=n("combos");if(e.innerHTML="",!o.length){e.innerHTML=' < div class = "hint" > No hay combinación posible con los límites actuales. < /div>',n("nota").textContent="";return}e.innerHTML=o.map((l,m)=>{const p=l.suma-a,r=p>=0?"+":"−",i=Math.abs(p),v=p>=0?"ok":"warn",h=l.listaBTU.map(u=>Math.round(u/1e3));return`
				<ion-item lines="full">
					<ion-label>
						<div>
							<strong>#${m+1}</strong> • ${l.equipos} equipo(s)
						</div>
						<div class="chips" style="margin:6px 0 8px;">${h.map(u=>`
							<span class="chip">${u} KBTU</span>`).join("")}
						</div>
						<div class="muted">Suma: 
							<span class="mono">${M.format(Math.round(l.suma))}</span> BTU · ≈ 
							<span class="mono">${g(l.suma).toFixed(2)}</span> ton
						</div>
					</ion-label>
					<div slot="end" class="right">
						<div class="mono ${v}">${r}${M.format(Math.round(i))} BTU</div>
						<div class="hint">vs. objetivo</div>
					</div>
				</ion-item>`}).join("");const s=Math.min(...t);n("nota").innerHTML=`Objetivo: 
				<span class="mono">${M.format(Math.round(a))} BTU</span>.
      ${d?"Se permiten combinaciones que excedan el objetivo.":"No se permite exceder; intenta con más equipos."}
      Capacidad mínima: 
				<span class="mono">${Math.round(s/1e3)} KBTU</span>. Máx. equipos (auto): 
				<span class="mono">${c}</span>.`}async function I(){b||T();const{jsPDF:a}=window.jspdf,t=new a({unit:"mm",format:"a4"}),d=await q(),c=new Date,o=c.toLocaleString("es-MX");if(t.setFont("helvetica","bold"),t.setFontSize(16),t.text("JC, Electricista y Climatización",14,18),d)try{t.addImage(d,"PNG",170,10,26,26)}catch{}t.setFont("helvetica","normal"),t.setFontSize(11),t.text("Reporte de cálculo BTU",14,26),t.text(`Fecha: ${o}`,14,32);let e=42,s=14;const l=(n("clienteNombre").value||"").trim(),m=(n("clienteDireccion").value||"").trim(),p=(n("clienteTelefono").value||"").trim();(l||m||p)&&(t.setFont("helvetica","bold"),t.text("Cliente",s,e),e+=6,t.setFont("helvetica","normal"),l&&(t.text(`Nombre: ${l}`,s,e),e+=6),m&&(t.text(`Dirección: ${m}`,s,e),e+=6),p&&(t.text(`Teléfono: ${p}`,s,e),e+=6),e+=2);const r=n("area").value||"",i=n("personas").value||"0",v=n("areaVentanas").value||"0",h=n("luminarias").value||"0",u=n("toggleOvershoot").checked?"Sí":"No";t.setFont("helvetica","bold"),t.text("Entradas",s,e),e+=6,t.setFont("helvetica","normal"),[`Área del local: ${r} m²`,`Personas: ${i}`,`Área de ventanas: ${v} m²`,`Luminarias: ${h}`,`Permitir sobrecapacidad: ${u}`].forEach(f=>{t.text(f,s,e),e+=6}),e+=2,t.setFont("helvetica","bold"),t.text("Resultado",s,e),e+=6,t.setFont("helvetica","normal"),t.text(`Total: ${M.format(Math.round(b))} BTU  (≈ ${g(b).toFixed(2)} ton)`,s,e),e+=8,t.setFont("helvetica","bold"),t.text("Mejores combinaciones (top 5)",s,e),e+=6,t.setFont("helvetica","normal"),$.forEach((f,y)=>{const B=f.listaBTU.map(E=>`${Math.round(E/1e3)} KBTU`).join(" + "),F=f.suma-b,C=F>=0?"+":"−",L=M.format(Math.round(Math.abs(F))),P=`${y+1}) ${B}`,U=`Suma: ${M.format(Math.round(f.suma))} BTU (≈ ${g(f.suma).toFixed(2)} ton)  ·  Δ ${C}${L} BTU`;e>270&&(t.addPage(),e=18),t.text(P,s,e),e+=6,t.text(U,s+4,e),e+=7}),t.save(`JC-HVAC-BTU-${c.toISOString().slice(0,19).replace(/[:T]/g,"-")}.pdf`)}function V(){["clienteNombre","clienteDireccion","clienteTelefono","area","personas","areaVentanas","luminarias"].forEach(a=>n(a).value=""),["s5","tons"].forEach(a=>n(a).textContent="—"),n("combos").innerHTML="",n("nota").textContent="",b=0,$=[]}n("btnCalcular").addEventListener("click",T);n("btnPdf").addEventListener("click",I);n("btnReset").addEventListener("click",V);n("area").value||(n("clienteNombre").value="Juan Perez",n("clienteDireccion").value="San Francisco 730, Colonia Fuentes de San Hildefonso",n("clienteTelefono").value="9981554466",n("area").value="75",n("personas").value="23",n("areaVentanas").value="9.6",n("luminarias").value="20");T();
